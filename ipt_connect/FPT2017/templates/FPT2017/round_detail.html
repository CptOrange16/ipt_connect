{% extends 'FPT2017/head.html' %}
{% load humanize %}

{% block content %}
{% for round in round %}


    {% if finished %}
        <div class="section">
            <h1>{{round}}</h1>
        </div>

        <div class="content container">
            <p class="emphase">Problème présenté: <a href="{% url 'FPT2017:problem_detail' pk=round.problem_presented.pk %}">{{round.problem_presented.name}}</a></p>
        </div>


        <div class="content container">
            <table>
                <tr>
                    <th class="td-center"></th>
                    <th class="td-center">Reporter</th>
                    <th class="td-center">Opponent</th>
                    <th class="td-center">Reviewer</th>
                </tr>

                <tr>
                    <td class="td-center"></td>
                    <td class="td-center"><a href="{% url 'FPT2017:team_detail' team_name=round.reporter.team.name %}">{{round.reporter.team.name}}</a> -- <a href="{% url 'FPT2017:participant_detail' pk=round.reporter.pk %}">{{round.reporter.fullname}}</a></td>
                    <td class="td-center"><a href="{% url 'FPT2017:team_detail' team_name=round.opponent.team.name %}">{{round.opponent.team.name}}</a> -- <a href="{% url 'FPT2017:participant_detail' pk=round.opponent.pk %}">{{round.opponent.fullname}}</a></td>
                    <td class="td-center"><a href="{% url 'FPT2017:team_detail' team_name=round.reviewer.team.name %}">{{round.reviewer.team.name}}</a> -- <a href="{% url 'FPT2017:participant_detail' pk=round.reviewer.pk %}">{{round.reviewer.fullname}}</a></td>
                </tr>

            </table>
        </div>


        <div class="content container">
            <table>
                <tr>
                    <th>Jurés</th>
                    <th class="td-center">Note du Reporter</th>
                    <th class="td-center">Note de l'Opponent</th>
                    <th class="td-center">Note du Reviewer</th>
                </tr>

                {% for jurygrade in jurygrades %}
                    <tr>
                        <td><a href="{% url 'FPT2017:jury_detail' pk=jurygrade.jury.pk %}">{{jurygrade.jury.name}}</a></td>
                        <td class="td-center">{{jurygrade.grade_reporter|floatformat:2}}</td>
                        <td class="td-center">{{jurygrade.grade_opponent|floatformat:2}}</td>
                        <td class="td-center">{{jurygrade.grade_reviewer|floatformat:2}}</td>
                    </tr>
                {% endfor %}

                <tr>
                    <td><p class="emphase">Moyenne*</p></td>
                    {% for meangrade in meangrades %}
                    <td class="td-center"><p class="emphase">{{meangrade|floatformat:2}}</p></td>
                    {% endfor %}
                </tr>

            </table>
        </div>

        <div class="content container">
            <p class="comment">*La moins bonne note n'est pas prise en compte; et s'il y a plus de sept jurés, la plus haute note non plus. Ici les coefficients multiplicatifs liés aux rôles (3,2 et 1) ne sont pas pris en compte.</p>
        </div>



        <div class="content container">

            {% if tacticalrejections.count > 0 %}
            <p>Rejets temporaires:</p>
            {% endif %}
            {% for tacticalrejection in tacticalrejections %}
            <li><a href="{% url 'FPT2017:problem_detail' pk=tacticalrejection.problem.pk %}">{{tacticalrejection.problem.name}}</a></li>
            {% empty %}
            <p>Pas de rejet temporaire</p>
            {% endfor %}
        </div>

        {% for eternalrejection in eternalrejection %}
        <div class="content container">
            <p>Rejet permanent:</p>
            <li><a href="{% url 'FPT2017:problem_detail' pk=eternalrejection.problem.pk %}">{{eternalrejection.problem.name}}</a></li>
        </div>
        {% empty %}
        <div class="content container">
            <p>Pas de rejet permanent</p>
        </div>
        {% endfor %}

    {% endif %}

    {% if started %}

        {% if not finished %}
            <div class="section">
                <h1>{{round}}</h1>
            </div>
            <div class="content container">
                <table>
                    <tr>

                         <th class="td-center">Reporter</th>
                         <th class="td-center">Opponent</th>
                         <th class="td-center">Reviewer</th>
                    </tr>

                    <tr>

                         <td class="td-center"><a href="{% url 'FPT2017:team_detail' team_name=round.reporter_team.name %}">{{round.reporter_team.name}}</a></td>
                         <td class="td-center"><a href="{% url 'FPT2017:team_detail' team_name=round.opponent_team.name %}">{{round.opponent_team.name}}</a></td>
                         <td class="td-center"><a href="{% url 'FPT2017:team_detail' team_name=round.reviewer_team.name %}">{{round.reviewer_team.name}}</a></td>
                     </tr>

                 </table>
           </div>
        {% endif %}

        <div class="content container">
            {% if round.unavailable_problems %}
                <p class="emphase">Problème(s) bloqué(s):</p>

                {% if round.unavailable_problems.presented_this_pf %}
                    {% for problem in round.unavailable_problems.presented_this_pf %}
                        <li><a href="{% url 'FPT2017:problem_detail' pk=problem.pk %}">{{problem.name}}</a> a déjà été présenté dans ce Physics Fight</li>
                    {% endfor %}
                {% endif %}

                {% if round.unavailable_problems.eternal_rejection %}
                    {% for problem in round.unavailable_problems.eternal_rejection %}
                        <li><a href="{% url 'FPT2017:problem_detail' pk=problem.pk %}">{{problem.name}}</a> a été rejeté de façon permanente</li>
                    {% endfor %}
                {% endif %}

                {% if round.unavailable_problems.presented_by_reporter %}
                    {% for problem in round.unavailable_problems.presented_by_reporter %}
                        <li><a href="{% url 'FPT2017:problem_detail' pk=problem.pk %}">{{problem.name}}</a> a été présenté plus tôt par le Reporter</li>
                    {% endfor %}
                {% endif %}

                {% if round.unavailable_problems.opposed_by_opponent %}
                    {% for problem in round.unavailable_problems.opposed_by_opponent %}
                        <li><a href="{% url 'FPT2017:problem_detail' pk=problem.pk %}">{{problem.name}}</a> a été opposé plus tôt par l'Opponent</li>
                    {% endfor %}
                {% endif %}

                {% if round.unavailable_problems.presented_by_opponent %}
                    {% for problem in round.unavailable_problems.presented_by_opponent %}
                        <li><a href="{% url 'FPT2017:problem_detail' pk=problem.pk %}">{{problem.name}}</a> a été présenté plus tôt par l'Opponent</li>
                    {% endfor %}
                {% endif %}

            {% endif %}
        </div>
    {% else %}
        <div class="section">
            <h1>{{round}}</h1>
        </div>

        <div class="content container">
            <p>Cette ronde n'est pas encore démarrée !</p>
        </div>
    {% endif %}


{% endfor %}
{% endblock content %}
